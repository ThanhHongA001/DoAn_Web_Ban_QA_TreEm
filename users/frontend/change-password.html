<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Đổi mật khẩu - SuSu Kids Shop.">
    <meta name="keywords" content="đổi mật khẩu, tài khoản, quần áo trẻ em">
    <title>Đổi mật khẩu - SuSu Kids Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="bg-yellow-50 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-md fixed w-full top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <img id="site-logo" src="" alt="Logo SuSu Kids" class="h-16 rounded-full">
                <h1 class="ml-4 text-3xl font-bold text-blue-600">SuSu Kids Shop</h1>
            </div>
            <div class="flex items-center space-x-6">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Tìm quần áo cho bé..." class="p-2 pr-10 border border-blue-300 rounded-full w-72 focus:outline-none focus:ring-2 focus:ring-blue-400" oninput="fetchSearchSuggestions()" onkeypress="if(event.key === 'Enter') searchProducts()">
                    <button onclick="searchProducts()" class="absolute right-2 top-2 text-blue-600 hover:text-blue-800">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>
                    <div id="search-suggestions" class="absolute hidden bg-white border border-blue-300 rounded-lg w-full mt-1 shadow-lg z-10"></div>
                </div>
                <nav class="flex space-x-6">
                    <a href="index.html" class="text-blue-600 hover:text-pink-600 font-semibold">Trang chủ</a>
                    <a href="about.html" class="text-blue-600 hover:text-pink-600 font-semibold">Giới thiệu</a>
                    <a href="category.html" class="text-blue-600 hover:text-pink-600 font-semibold">Sản phẩm</a>
                    <a href="blog.html" class="text-blue-600 hover:text-pink-600 font-semibold">Blog</a>
                    <a href="contact.html" class="text-blue-600 hover:text-pink-600 font-semibold">Liên hệ</a>
                    <a href="cart.html" class="relative">
                        <svg class="w-6 h-6 text-blue-600 hover:text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-pink-500 text-white text-xs rounded-full px-1">0</span>
                    </a>
                    <div class="relative">
                        <button id="user-menu-btn" class="text-blue-600 hover:text-pink-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </button>
                        <div id="user-menu" class="absolute hidden right-0 mt-2 w-48 bg-white border border-blue-300 rounded-lg shadow-lg">
                            <div id="guest-menu" class="py-2">
                                <a href="login.html" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Đăng nhập</a>
                                <a href="register.html" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Đăng ký</a>
                            </div>
                            <div id="user-settings-menu" class="hidden py-2">
                                <a href="account.html" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Thông tin cá nhân</a>
                                <a href="orders.html" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Đơn hàng</a>
                                <a href="change-password.html" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Đổi mật khẩu</a>
                                <a href="#" id="logout-btn" class="block px-4 py-2 text-blue-600 hover:bg-blue-50">Đăng xuất</a>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-4 py-4 mt-24">
        <nav class="text-gray-600 text-sm">
            <a href="index.html" class="hover:text-blue-600">Trang chủ</a> / 
            <span class="text-blue-600">Đổi mật khẩu</span>
        </nav>
    </div>

    <!-- Change Password Section -->
    <section class="container mx-auto px-4 py-8">
        <h2 class="text-3xl font-bold text-center text-blue-600 mb-8">Đổi mật khẩu</h2>
        <div id="login-prompt" class="hidden bg-white p-6 rounded-lg shadow-md text-center">
            <p class="text-gray-600 mb-4">Vui lòng đăng nhập để đổi mật khẩu.</p>
            <a href="login.html" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">Đăng nhập</a>
        </div>
        <div id="change-password-container" class="hidden max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
            <form id="change-password-form">
                <div class="mb-4">
                    <label for="current-password" class="block text-blue-600 font-semibold mb-2">Mật khẩu hiện tại</label>
                    <input type="password" id="current-password" name="current-password" class="w-full p-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                </div>
                <div class="mb-4">
                    <label for="new-password" class="block text-blue-600 font-semibold mb-2">Mật khẩu mới</label>
                    <input type="password" id="new-password" name="new-password" class="w-full p-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                    <p class="text-sm text-gray-600 mt-1">Mật khẩu phải có ít nhất 8 ký tự.</p>
                </div>
                <div class="mb-6">
                    <label for="confirm-password" class="block text-blue-600 font-semibold mb-2">Xác nhận mật khẩu mới</label>
                    <input type="password" id="confirm-password" name="confirm-password" class="w-full p-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                </div>
                <button type="submit" class="w-full bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600 transition">Đổi mật khẩu</button>
            </form>
            <div id="form-message" class="mt-4 text-center hidden"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-blue-600 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">SuSu Kids</h3>
                    <p>Thời trang trẻ em chất lượng, an toàn cho bé yêu.</p>
                    <ul>
                        <li><a href="about.html" class="text-yellow-400 hover:text-yellow-300">Giới thiệu</a></li>
                        <li><a href="baomat.html" class="text-yellow-400 hover:text-yellow-300">Chính sách bảo mật</a></li>
                        <li><a href="doitra.html" class="text-yellow-400 hover:text-yellow-300">Chính sách đổi trả</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Liên kết nhanh</h3>
                    <ul>
                        <li><a href="category.html" class="hover:text-yellow-400">Sản phẩm</a></li>
                        <li><a href="blog.html" class="hover:text-yellow-400">Blog</a></li>
                        <li><a href="contact.html" class="hover:text-yellow-400">Liên hệ</a></li>
                        <li><a href="size.html" class="hover:text-yellow-400">Hướng dẫn chọn size</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Liên hệ</h3>
                    <p>Email: support@susukids.com</p>
                    <p>Phone: 0905 123 456</p>
                    <p>Address: 456 Đường Trẻ Thơ, Hà Nội</p>
                </div>
            </div>
            <div class="mt-8 text-center">
                <p>© 2025 SuSu Kids Shop. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="assets/js/user-menu.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            fetchCartCount();
            document.getElementById('change-password-form').addEventListener('submit', handleChangePassword);
        });

        function checkLoginStatus() {
            fetch('api/check_session.php')
                .then(response => response.json())
                .then(data => {
                    if (data.isLoggedIn) {
                        document.getElementById('change-password-container').classList.remove('hidden');
                        document.getElementById('login-prompt').classList.add('hidden');
                    } else {
                        document.getElementById('change-password-container').classList.add('hidden');
                        document.getElementById('login-prompt').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error checking login status:', error);
                    document.getElementById('login-prompt').classList.remove('hidden');
                });
        }

        function fetchCartCount() {
            fetch('api/cart.php?action=count')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cart-count').textContent = data.count || 0;
                })
                .catch(error => console.error('Error fetching cart count:', error));
        }

        function fetchSearchSuggestions() {
            const query = document.getElementById('search-input').value.trim();
            const suggestionsDiv = document.getElementById('search-suggestions');
            if (query.length < 2) {
                suggestionsDiv.classList.add('hidden');
                suggestionsDiv.innerHTML = '';
                return;
            }
            fetch(`api/search_products.php?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsDiv.innerHTML = '';
                    if (data.length > 0) {
                        suggestionsDiv.classList.remove('hidden');
                        data.forEach(product => {
                            const div = document.createElement('div');
                            div.className = 'flex items-center px-4 py-2 text-blue-600 cursor-pointer hover:bg-blue-50';
                            div.innerHTML = `
                                <img src="${product.image}" alt="${product.name}" class="w-10 h-10 rounded mr-2 object-cover">
                                <div>
                                    <p>${product.name}</p>
                                    <p class="text-pink-600">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.discounted_price)}</p>
                                </div>
                            `;
                            div.onclick = () => window.location.href = `product-details.html?code=${product.code}`;
                            suggestionsDiv.appendChild(div);
                        });
                    } else {
                        suggestionsDiv.classList.add('hidden');
                    }
                })
                .catch(error => console.error('Error fetching suggestions:', error));
        }

        function searchProducts() {
            const query = document.getElementById('search-input').value.trim();
            window.location.href = `category.html?q=${encodeURIComponent(query)}`;
        }

        function handleChangePassword(event) {
            event.preventDefault();
            const form = event.target;
            const currentPassword = form['current-password'].value;
            const newPassword = form['new-password'].value;
            const confirmPassword = form['confirm-password'].value;
            const messageDiv = document.getElementById('form-message');

            if (newPassword.length < 8) {
                showMessage('Mật khẩu mới phải có ít nhất 8 ký tự', 'text-red-600');
                return;
            }

            if (newPassword !== confirmPassword) {
                showMessage('Mật khẩu xác nhận không khớp', 'text-red-600');
                return;
            }

            fetch('api/change-password.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showMessage('Đổi mật khẩu thành công! Vui lòng đăng nhập lại.', 'text-green-600');
                        form.reset();
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        showMessage(data.error || 'Lỗi khi đổi mật khẩu', 'text-red-600');
                    }
                })
                .catch(error => {
                    console.error('Error changing password:', error);
                    showMessage('Lỗi khi đổi mật khẩu', 'text-red-600');
                });
        }

        function showMessage(message, className) {
            const messageDiv = document.getElementById('form-message');
            messageDiv.textContent = message;
            messageDiv.className = `mt-4 text-center ${className}`;
            messageDiv.classList.remove('hidden');
        }

        //logo
        fetch("api/get_logo.php")
        .then(res => res.json())
        .then(data => {
            document.getElementById("site-logo").src = data.logo;
        })
        .catch(err => console.error(err));
    </script>
</body>
</html>